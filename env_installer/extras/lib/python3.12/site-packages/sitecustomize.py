import os
import subprocess
import sys

need_installation = False
try:
    # FIXME find simpler way to check the installation as importing mitosheet is long
    import mitosheet
except ImportError:
    need_installation = True

if os.environ.get("MITO_INSTALLATION", "0") != "1" and need_installation:
    env = os.environ.copy()
    env["MITO_INSTALLATION"] = "1"
    try:
        print("Installing missing mito packages...", file=sys.stderr)
        subprocess.run(
            [
                "uv",
                "pip",
                "install",
                "mito-ai",
                "mitosheet",
                "ipympl>=0.8.2",
                "ipywidgets>=8.0.1",
                "jupyterlab==4.4.6",
                "matplotlib==3.9.2",
                "numpy==2.1.*",
                "pandas"
            ],
            check=True,
            env=env
        )
    except subprocess.CalledProcessError as e:
        print(f"An error occurred while installing packages: {e}", file=sys.stderr)
